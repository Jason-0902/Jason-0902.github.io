
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Relational Algebra CLI (Web)</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
  <script defer src="js/app.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    textarea { width: 100%; height: 100px; font-family: monospace; }
    #output { white-space: pre-wrap; background: #fff; padding: 10px; border: 1px solid #ccc; margin-top: 10px; }
    button { padding: 10px 20px; margin-top: 10px; }
    h2 { color: #007acc; margin-top: 2em; }
    code { background: #eee; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Relational Algebra CLI Simulator (Pyodide)</h1>

  <h2>üìò Supported Commands</h2>
  <table border="1" cellpadding="6" style="border-collapse: collapse; background: #fff;">
    <thead><tr><th>Command</th><th>Syntax Example</th></tr></thead>
    <tbody>
      <tr><td>CREATE TABLE</td><td><code>CREATE TABLE students (id, name)</code></td></tr>
      <tr><td>INSERT INTO</td><td><code>INSERT INTO students VALUES (1, 'Alice')</code></td></tr>
      <tr><td>SELECT</td><td><code>SELECT * FROM students</code></td></tr>
      <tr><td>PROJECT</td><td><code>PROJECT name, id FROM students</code></td></tr>
      <tr><td>RENAME</td><td><code>RENAME name TO student_name IN students</code></td></tr>
      <tr><td>UNION</td><td><code>UNION students1, students2 BY id, name</code></td></tr>
      <tr><td>DIFFERENCE</td><td><code>DIFFERENCE students1, alumni BY id</code></td></tr>
      <tr><td>INTERSECT</td><td><code>INTERSECT A, B BY name</code></td></tr>
      <tr><td>DIVIDE</td><td><code>DIVIDE takes BY courses</code></td></tr>
      <tr><td>JOIN</td><td><code>JOIN students, teachers</code></td></tr>
    </tbody>
  </table>

  <p><strong>Note:</strong> Use <code>Enter</code> to run; <code>Shift+Enter</code> for new line.</p>

  <h2>üß™ Try it below</h2>
  <textarea id="input" placeholder="Type your command here..."></textarea>
  <br />
  <button onclick="runPython()">Execute</button>
  <div id="output">Output will appear here...</div>

  <script id="pycode" type="text/plain">
import pandas as pd

tables = {}

def run_command(cmd: str) -> str:
    global tables
    try:
        cmd = cmd.strip()
        if cmd.upper().startswith("CREATE TABLE"):
            name, cols = cmd[13:].split("(", 1)
            name = name.strip()
            cols = [c.strip() for c in cols.strip(")").split(",")]
            tables[name] = pd.DataFrame(columns=cols)
            return f"‚úÖ Created table '{name}' with columns: {cols}"
        elif cmd.upper().startswith("INSERT INTO"):
            name, rest = cmd[12:].split("VALUES", 1)
            name = name.strip()
            values = rest.strip().strip("()").split(",")
            values = [v.strip().strip("'\"") for v in values]
            if name not in tables:
                return f"‚ùå Table '{name}' does not exist"
            tables[name].loc[len(tables[name])] = values
            return f"‚úÖ Inserted into '{name}': {values}"
        elif cmd.upper().startswith("SELECT * FROM"):
            name = cmd[14:].strip()
            if name not in tables:
                return f"‚ùå Table '{name}' does not exist"
            return str(tables[name])
        elif cmd.upper().startswith("PROJECT"):
            rest = cmd[7:].strip()
            cols_part, tbl = rest.split("FROM")
            cols = [c.strip() for c in cols_part.strip().split(",")]
            tbl = tbl.strip()
            if tbl not in tables:
                return f"‚ùå Table '{tbl}' does not exist"
            return str(tables[tbl][cols])
        elif cmd.upper().startswith("RENAME"):
            parts = cmd[7:].split("TO")
            old = parts[0].strip()
            new, rest = parts[1].split("IN")
            new = new.strip()
            tbl = rest.strip()
            if tbl not in tables or old not in tables[tbl].columns:
                return f"‚ùå Table or column not found"
            tables[tbl] = tables[tbl].rename(columns={old: new})
            return f"‚úÖ Renamed '{old}' to '{new}' in '{tbl}'"
        elif cmd.upper().startswith("JOIN"):
            a, b = cmd[5:].split(",")
            a, b = a.strip(), b.strip()
            if a not in tables or b not in tables:
                return f"‚ùå Table not found"
            return str(pd.merge(tables[a], tables[b], on=list(set(tables[a].columns) & set(tables[b].columns))))
        elif cmd.upper().startswith("UNION"):
            args = cmd[6:].split("BY")
            a_b, cols = args[0], args[1]
            a, b = a_b.split(",")
            a, b = a.strip(), b.strip()
            cols = [c.strip() for c in cols.strip().split(",")]
            return str(pd.concat([tables[a][cols], tables[b][cols]]).drop_duplicates().reset_index(drop=True))
        elif cmd.upper().startswith("DIFFERENCE"):
            args = cmd[10:].split("BY")
            a, b = args[0].split(",")
            cols = [c.strip() for c in args[1].strip().split(",")]
            df1 = tables[a.strip()][cols]
            df2 = tables[b.strip()][cols]
            return str(pd.merge(df1, df2, how='outer', indicator=True).query("_merge == 'left_only'").drop("_merge", axis=1))
        elif cmd.upper().startswith("INTERSECT"):
            args = cmd[9:].split("BY")
            a, b = args[0].split(",")
            cols = [c.strip() for c in args[1].strip().split(",")]
            return str(pd.merge(tables[a.strip()][cols], tables[b.strip()][cols]))
        elif cmd.upper().startswith("DIVIDE"):
            a, b = cmd[6:].split("BY")
            a, b = a.strip(), b.strip()
            df1, df2 = tables[a], tables[b]
            cols = list(set(df1.columns) - set(df2.columns))
            grouped = df1.groupby(cols).filter(lambda g: df2.merge(g, how='left', on=df2.columns.tolist()).dropna().shape[0] == len(df2))
            return str(grouped[cols].drop_duplicates().reset_index(drop=True))
        else:
            return "‚ùå Unsupported command"
    except Exception as e:
        return f"‚ùå Error: {e}"
  </script>
</body>
</html>
